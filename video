from astrbot.core.message.message_event_result import MessageEventResult
from astrbot.core.message.components import Video, Plain
import httpx
import tempfile
import os
import asyncio

async def fetch_url(client, url, headers, params):
    resp = await client.get(url, headers=headers, params=params)
    return resp

async def beautyDid(command, headers, params):
    url = f"https://api.317ak.cn/api/sp/didjj"
    if command in ["did美女", "did"]:
        async with httpx.AsyncClient() as client:
            response = await fetch_url(client, url, headers, params)
            print(response.status_code)
            # 检查响应是否成功
            if response.status_code == 200:
                # 保存为视频文件（如 .mp4, .ts, .flv 等）
                output_path = "../tmp/output_video.mp4"
                with open(output_path, "wb") as f:
                    f.write(response.content)  # 注意：用 .content（二进制），不是 .text
                print("视频已保存为 output_video.mp4")
            else:
                print("请求失败:", response.status_code)
            # results = await asyncio.gather(*tasks)




async def main():
    # ckey = "LCW4HP76R9LKRWXCEMAX"
    headers = {
        # "ckey": "LCW4HP76R9LKRWXCEMAX",
        "Content-Type": "application/none",
        "User-Agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36"
    }

    params = {
        "ckey": "LCW4HP76R9LKRWXCEMAX",
    }

    await beautyDid("did美女", headers, params)

asyncio.run(main())